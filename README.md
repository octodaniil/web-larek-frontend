# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/blocks/index.css — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Интерфейсы

#### IProduct

Описание: Интерфейс, определяющий структуру данных для продукта.

Свойства:

- id: string: Уникальный идентификатор продукта.
- description: string: Описание продукта.
- image: string: URL изображения продукта.
- title: string: Название продукта.
- category: string: Категория продукта.
- price: number: Цена продукта.

#### IProductsData

Описание: Интерфейс, определяющий состояние данных о продуктах.

Свойства:

- products: IProduct[]: Массив продуктов.
- preview: string | null: Идентификатор продукта, выбранного для предварительного просмотра.

#### IProductsList

Описание: Интерфейс, определяющий структуру данных для списка продуктов.

Свойства:

- total: number: Общее количество продуктов.
- items: IProduct[]: Массив продуктов.

#### IModal

Описание: Интерфейс, определяющий методы и свойства модального окна.

Свойства:

- modalContainer: HTMLElement: Контейнер модального окна.
- modalContent: HTMLElement: Содержимое модального окна.
- closeButton: HTMLElement: Кнопка закрытия модального окна.

Методы:

- open(): void: Открывает модальное окно.
- close(): void: Закрывает модальное окно.
- handleEscUp(evt: KeyboardEvent): void: Обработчик события нажатия клавиши Esc для закрытия модального окна.
- render(): HTMLElement: Возвращает HTML-элемент, представляющий модальное окно.

#### IBasketData

Описание: Интерфейс, определяющий данные и методы для корзины.

Свойства:

- basketProducts: IProduct[]: Массив продуктов, добавленных в корзину.

Методы:

- getTotalSum(): number: Возвращает общую сумму продуктов в корзине.
- getCounter(): number: Возвращает количество продуктов в корзине.
- addSelectedProduct(data: IProduct): void: Добавляет выбранный продукт в корзину.
- clearBasket(): void: Очищает корзину.
- removeProductFromBasket(product: string): void: Удаляет продукт из корзины.

#### IBasket

Описание: Интерфейс, определяющий структуру и методы для компонента корзины.

Свойства:

- basket: HTMLElement: Контейнер для корзины.
- basketTitle: HTMLElement: Заголовок корзины.
- basketList: HTMLElement: Список продуктов в корзине.
- basketButton: HTMLButtonElement: Кнопка корзины.
- basketPrice: HTMLElement: Элемент для отображения общей суммы корзины.
- headerBasketButton: HTMLButtonElement: Кнопка корзины в header.
- headerBasketCounter: HTMLElement: Элемент для отображения количества продуктов в корзине.

Методы:

- updateBasketCounter(value: number): void: Обновляет счётчик количества продуктов в корзине.
- setTotalSum(totalSum: number): void: Устанавливает общую сумму продуктов в корзине.
- render(): HTMLElement: Возвращает HTML-элемент, представляющий компонент корзины.

#### IBasketItem

Описание: Интерфейс, определяющий структуру и методы для элемента корзины.

Свойства:

- basketItem: HTMLElement: Контейнер для элемента корзины.
- index: HTMLElement: Элемент для отображения индекса продукта.
- basketCardTitle: HTMLElement: Элемент для отображения названия продукта.
- basketCardPrice: HTMLElement: Элемент для отображения цены продукта.
- basketCardButtonDelete: HTMLButtonElement: Кнопка для удаления продукта из корзины.

Методы:

- render(data: IProduct, item: number): HTMLElement: Возвращает HTML-элемент, представляющий элемент корзины.

#### Errors

Описание: Тип, определяющий структуру ошибок для формы заказа.

Тип: Partial<Record<keyof IOrderData, string>>

#### IOrderForm

Описание: Интерфейс, определяющий структуру и методы для формы заказа.

Свойства:

- orderForm: HTMLFormElement: Форма заказа.
- payment: string: Выбранный метод оплаты.
- errors: HTMLElement: Элемент для отображения ошибок.
- buttons: HTMLButtonElement[]: Кнопки формы.

Методы:

- render(): HTMLElement: Возвращает HTML-элемент, представляющий форму заказа.

#### IOrderData

Описание: Интерфейс, определяющий структуру данных для заказа.

Свойства:

- payment: string: Выбранный метод оплаты.
- address: string: Адрес доставки.
- phone: string: Номер телефона.
- email: string: Электронная почта.
- total: number: Общая сумма заказа.
- items: string[]: Список идентификаторов продуктов в заказе.

Методы:

- setOrderForm(fieldAndValue: { field: string; value: string }): void: Устанавливает значение для поля формы заказа.
- validateOrderForm(): boolean: Проверяет валидность формы заказа.
- setContactForm(fieldAndValue: { field: string; value: string }): void: Устанавливает значение для поля формы контактов.
- validateContactForm(): boolean: Проверяет валидность формы контактов.
- getPurchase(): object: Возвращает объект с данными для оформления покупки.

#### IContactsForm

Описание: Интерфейс, определяющий структуру и методы для формы контактов.

Свойства:

- contactsForm: HTMLFormElement: Форма контактов.
- inputs: HTMLInputElement[]: Массив полей ввода.
- submitButton: HTMLButtonElement: Кнопка отправки формы.
- errors: HTMLElement: Элемент для отображения ошибок.

Методы:

- render(): HTMLElement: Возвращает HTML-элемент, представляющий форму контактов.

#### IOrderFinal

Описание: Интерфейс, определяющий структуру и методы для финального экрана заказа.

Свойства:

- final: HTMLElement: Контейнер для финального экрана.
- description: HTMLElement: Элемент для отображения описания.
- button: HTMLButtonElement: Кнопка для возврата на главную страницу.

Методы:

- render(total: number): HTMLElement: Возвращает HTML-элемент, представляющий финальный экран заказа.

### Классы

### Класс Product

#### Описание

Класс `Product` относится к слою представления (View) приложения. Он реализует интерфейс `IProduct` и отвечает за отображение информации о продукте на странице.

##### Интерфейс

Класс `Product` реализует интерфейс `IProduct`.

##### Конструктор

constructor(protected container: HTMLElement, protected events: IEvents)

- container: HTMLElement - HTML-контейнер, в который будет рендериться информация о продукте.
- events: IEvents - объект, реализующий интерфейс IEvents, используется для эмиссии событий.

#### Методы

##### getElement(): HTMLElement

Возвращает HTML-контейнер, в который рендерится информация о продукте.

##### render(productData: Partial<IProduct>): HTMLElement

Обновляет информацию о продукте в соответствии с переданными данными. Возвращает HTML-контейнер с обновленной информацией.

#### Сеттеры

- set category(category: string): устанавливает категорию продукта.
- set title(title: string): устанавливает название продукта.
- set description(description: string): устанавливает описание продукта.
- set image(image: string): устанавливает изображение продукта.
- set price(price: number | null): устанавливает цену продукта.
- set id(id: string): устанавливает идентификатор продукта.

#### Геттеры

- get id(): string: возвращает идентификатор продукта.

### Класс ProductsData

#### Описание

Класс ProductsData относится к слою модели (Model) приложения. Он реализует интерфейс IProductsData и отвечает за хранение и управление данными о продуктах.

##### Интерфейс

Класс ProductsData реализует интерфейс IProductsData.

##### Конструктор

constructor(protected events: IEvents)

- events: IEvents - объект, реализующий интерфейс IEvents, используется для эмиссии событий.

#### Свойства

##### \_products: IProduct[]

Хранит массив продуктов.

##### \_preview: string | null

Хранит идентификатор выбранного продукта для предварительного просмотра.

##### productsData: Promise<IProduct[]>

Хранит Promise, который разрешается массивом продуктов.

#### Методы

##### set products(products: IProduct[])

Устанавливает массив продуктов.

##### get products(): IProduct[]

Возвращает массив продуктов.

##### getProduct(productId: string): IProduct | undefined

Возвращает продукт с заданным идентификатором или undefined, если продукт не найден.

##### set preview(productId: string | null)

Устанавливает идентификатор выбранного продукта для предварительного просмотра. Если productId null, то сбрасывает предварительный просмотр. Если продукт с заданным идентификатором найден, то эмитирует событие 'product:selected'.

### Класс ProductsContainer

#### Описание

Класс ProductsContainer относится к слою представления (View) приложения. Он управляет отображением коллекции продуктов на странице.

##### Интерфейс

Класс ProductsContainer реализует интерфейс IProductsContainer.

##### Конструктор

constructor(protected container: HTMLElement)

- container: HTMLElement - HTML-контейнер, в который будут рендериться продукты.

#### Свойства

##### \_gallery: HTMLElement

Хранит HTML-элемент, в который будут рендериться продукты.

#### Методы

##### set gallery(items: HTMLElement[])

Устанавливает массив HTML-элементов продуктов в контейнер. Заменяет все существующее содержимое контейнера на новые элементы.

### Класс Modal

#### Описание

Класс Modal относится к слою представления (View) приложения. Он отвечает за отображение модального окна на странице.

##### Интерфейс

Класс Modal реализует интерфейс IModal.

##### Конструктор

constructor(protected container: HTMLElement, protected events: IEvents)

- container: HTMLElement - HTML-контейнер, в котором будет отображаться модальное окно.
- events: IEvents - объект, реализующий интерфейс IEvents, используется для эмиссии событий.

#### Свойства

##### modalContainer: HTMLElement

Хранит HTML-элемент контейнера модального окна.

##### modalContent: HTMLElement

Хранит HTML-элемент содержимого модального окна.

##### closeButton: HTMLElement

Хранит HTML-элемент кнопки закрытия модального окна.

##### wrapper: HTMLElement

Хранит HTML-элемент обёртки страницы.

#### Методы

##### set content(content: HTMLElement)

Устанавливает новое содержимое в модальное окно, заменяя существующее.

##### set locked(value: boolean)

Устанавливает или снимает блокировку обёртки страницы для предотвращения скроллинга при открытии модального окна.

##### open()

Открывает модальное окно, добавляя ему класс "modal_active". Также добавляет обработчик события "keyup" для отлавливания нажатия клавиши "Escape" для закрытия окна и эмитирует событие "modal:open".

##### close()

Закрывает модальное окно, удаляя у него класс "modal_active". Также удаляет обработчик события "keyup" и эмитирует событие "modal:close".

##### handleEscUp(evt: KeyboardEvent)

Обработчик события "keyup", закрывающий модальное окно при нажатии на клавишу "Escape".

##### render(): HTMLElement

Открывает модальное окно и возвращает контейнер модального окна.

### Класс BasketData

#### Описание

Класс BasketData относится к слою модели (Model) приложения. Он реализует интерфейс IBasketData и отвечает за управление данными корзины покупателя.

##### Интерфейс

Класс BasketData реализует интерфейс IBasketData.

##### Конструктор

constructor()

В конструкторе класса BasketData инициализируется массив basketList, который будет хранить продукты, добавленные в корзину. Изначально этот массив пустой.

#### Свойства

##### basketList: IProduct[]

Хранит массив продуктов, добавленных в корзину.

#### Методы

##### set basketProducts(data: IProduct[])

Устанавливает массив продуктов, добавленных в корзину.

##### get basketProducts(): IProduct[]

Возвращает массив продуктов, добавленных в корзину.

##### getTotalSum(): number

Возвращает общую стоимость всех продуктов в корзине.

##### getCounter(): number

Возвращает количество продуктов в корзине.

##### addSelectedProduct(data: IProduct)

Добавляет новый продукт в корзину.

##### clearBasket()

Очищает корзину, удаляя из нее все продукты.

##### removeProductFromBasket(productId: string)

Удаляет продукт с указанным идентификатором из корзины.

### Класс Basket

#### Описание

Класс Basket относится к слою представления (View) приложения. Он отвечает за отображение корзины покупок на странице.

##### Конструктор

constructor(protected container: HTMLElement, protected events: IEvents)

- container: HTMLElement - HTML-контейнер, в котором будет отображаться корзина.
- events: IEvents - объект, реализующий интерфейс IEvents, используется для эмиссии и обработки событий.

#### Свойства

##### basketTitle: HTMLElement

Хранит HTML-элемент заголовка корзины.

##### basketList: HTMLElement

Хранит HTML-элемент списка продуктов в корзине.

##### basketButton: HTMLButtonElement

Хранит HTML-элемент кнопки "Оформить заказ".

##### basketPrice: HTMLElement

Хранит HTML-элемент, отображающий общую сумму корзины.

##### headerBasketButton: HTMLButtonElement

Хранит HTML-элемент кнопки корзины в шапке страницы.

##### headerBasketCounter: HTMLElement

Хранит HTML-элемент, отображающий количество товаров в корзине.

#### Методы

##### set items(items: HTMLElement[])

Устанавливает массив HTML-элементов, представляющих продукты в корзине. Если массив пуст, то отображает сообщение "Пустота". Также управляет доступностью кнопки "Оформить заказ".

##### updateBasketCounter(value: number)

Обновляет отображение количества товаров в корзине в шапке страницы.

##### setTotalSum(totalSum: number)

Устанавливает общую стоимость товаров в корзине.

##### render()

Инициализирует отображение заголовка корзины и возвращает контейнер корзины.

### Класс BasketItem

#### Описание

Класс BasketItem относится к слою представления (View) приложения. Он отвечает за отображение элемента корзины на странице.

##### Конструктор

constructor(template: HTMLTemplateElement, protected events: IEvents)

- template: HTMLTemplateElement - HTML-шаблон, из которого будет клонироваться элемент корзины.
- events: IEvents - объект, реализующий интерфейс IEvents, используется для эмиссии событий.

#### Свойства

##### basketItem: HTMLElement

Хранит HTML-элемент, представляющий один элемент корзины.

##### index: HTMLElement

Хранит HTML-элемент, отображающий индекс элемента корзины.

##### basketCardTitle: HTMLElement

Хранит HTML-элемент, отображающий название продукта в корзине.

##### basketCardPrice: HTMLElement

Хранит HTML-элемент, отображающий цену продукта в корзине.

##### basketCardButtonDelete: HTMLButtonElement

Хранит HTML-элемент, представляющий кнопку для удаления продукта из корзины.

#### Методы

##### setPrice(price: number | null): string

Принимает цену продукта и возвращает её в отформатированном виде ("бесценно" в случае, если цена равна null).

##### render(data: IProduct, item: number): HTMLElement

Заполняет элемент корзины данными о продукте и его индексе в корзине. Возвращает сформированный HTML-элемент корзины.

### Класс OrderData

#### Описание

Класс OrderData отвечает за хранение и управление данными, связанными с оформлением заказа. Он реализует интерфейс IOrderData и взаимодействует с событиями, описанными в интерфейсе IEvents.

##### Конструктор

constructor(protected events: IEvents)

- events: IEvents - объект, реализующий интерфейс IEvents, используется для эмиссии и обработки событий.

#### Свойства

##### payment: string

Хранит данные о выбранном способе оплаты.

##### address: string

Хранит адрес доставки.

##### phone: string

Хранит номер телефона.

##### email: string

Хранит адрес электронной почты.

##### total: number

Хранит общую сумму заказа.

##### items: string[]

Хранит список заказанных товаров.

##### Errors: Errors

Хранит объект ошибок, связанных с оформлением заказа.

#### Методы

##### setOrderForm(fieldAndValue: { field: string; value: string })

Принимает объект с полем и его значением, обновляет соответствующее поле в OrderData и проверяет валидность формы заказа. Если форма валидна, генерирует событие order:done с объектом данных заказа.

##### validateOrderForm(): boolean

Проверяет валидность полей формы заказа и заполняет объект Errors с описанием ошибок. Генерирует событие errors:orderForm с объектом ошибок. Возвращает true, если форма валидна.

##### setContactForm(fieldAndValue: { field: string; value: string })

Принимает объект с полем и его значением, обновляет соответствующее поле в OrderData и проверяет валидность контактной формы. Если форма валидна, генерирует событие order:done с объектом данных заказа.

##### validateContactForm(): boolean

Проверяет валидность полей контактной формы и заполняет объект Errors с описанием ошибок. Генерирует событие errors:inputChange с объектом ошибок. Возвращает true, если форма валидна.

##### getPurchase(): IOrderData

Возвращает объект с данными заказа, включающий payment, address, phone, email, total и items.

### Класс OrderForm

#### Описание

Класс OrderForm отвечает за отображение формы оформления заказа и взаимодействие с ней. Он наследует от базового класса Component и использует событийную систему, реализованную в интерфейсе IEvents.

##### Конструктор

constructor(protected container: HTMLElement, protected events: IEvents)

- container: HTMLElement - HTML-контейнер, в котором будет отображаться форма заказа.
- events: IEvents - объект, реализующий интерфейс IEvents, используется для эмиссии и обработки событий.

#### Свойства

##### orderButton: HTMLButtonElement

Хранит HTML-элемент кнопки "Оформить заказ".

##### buttons: HTMLButtonElement[]

Хранит массив HTML-элементов кнопок выбора способа оплаты.

##### errors: HTMLElement

Хранит HTML-элемент, в котором будут отображаться ошибки формы.

#### Методы

##### set payment(paymentOption: string)

Устанавливает активный способ оплаты и обновляет визуальное состояние кнопок.

##### set valid(value: boolean)

Устанавливает состояние кнопки "Оформить заказ" в зависимости от валидности формы.

##### render(): HTMLElement

Возвращает контейнер формы заказа.

##### Конструктор и подписка на события

В конструкторе:

- Находит и сохраняет ссылки на необходимые HTML-элементы.
- Добавляет обработчики событий кликов на кнопки выбора способа оплаты, эмитируя событие order:payment.
- Добавляет обработчик события input на контейнере формы, эмитируя событие order:address.
- Добавляет обработчик события submit на контейнере формы, эмитируя событие contactsForm:open.

Данный класс отвечает за отображение и взаимодействие с формой оформления заказа, эмитируя события, связанные с изменениями в форме, для взаимодействия с другими компонентами приложения.

### Класс ContactsForm

#### Описание

Класс ContactsForm отвечает за отображение формы ввода контактных данных и взаимодействие с ней. Он наследует от базового класса Component и использует событийную систему, реализованную в интерфейсе IEvents.

##### Конструктор

constructor(protected container: HTMLElement, protected events: IEvents)

- container: HTMLElement - HTML-контейнер, в котором будет отображаться форма ввода контактных данных.
- events: IEvents - объект, реализующий интерфейс IEvents, используется для эмиссии и обработки событий.

#### Свойства

##### inputs: HTMLInputElement[]

Хранит массив HTML-элементов инпутов формы.

##### submitButton: HTMLButtonElement

Хранит HTML-элемент кнопки "Отправить".

##### errors: HTMLElement

Хранит HTML-элемент, в котором будут отображаться ошибки формы.

#### Методы

##### set valid(value: boolean)

Устанавливает состояние кнопки "Отправить" в зависимости от валидности формы.

##### render(): HTMLElement

Возвращает контейнер формы ввода контактных данных.

##### Конструктор и подписка на события

В конструкторе:

- Находит и сохраняет ссылки на необходимые HTML-элементы.
- Добавляет обработчики событий input на инпуты формы, эмитируя событие contacts:inputChange с информацией об изменённом поле.
- Добавляет обработчик события submit на контейнер формы, эмитируя событие final:open.

Данный класс отвечает за отображение и взаимодействие с формой ввода контактных данных, эмитируя события, связанные с изменениями в форме, для взаимодействия с другими компонентами приложения.

### Класс OrderFinal

#### Описание

Класс OrderFinal отвечает за отображение финального экрана после оформления заказа. Он использует событийную систему, реализованную в интерфейсе IEvents.

##### Конструктор

constructor(template: HTMLTemplateElement, protected events: IEvents)

- template: HTMLTemplateElement - HTML-шаблон, содержащий структуру финального экрана.
- events: IEvents - объект, реализующий интерфейс IEvents, используется для эмиссии и обработки событий.

#### Свойства

##### final: HTMLElement

Хранит HTML-элемент финального экрана.

##### description: HTMLElement

Хранит HTML-элемент, в котором будет отображаться сумма заказа.

##### button: HTMLButtonElement

Хранит HTML-элемент кнопки "Закрыть".

#### Методы

##### render(total: number): HTMLElement

Принимает общую сумму заказа, обновляет текст описания финального экрана и возвращает HTML-элемент финального экрана.

##### Конструктор и подписка на события

В конструкторе:

- Получает клонированный HTML-элемент финального экрана из шаблона.
- Находит и сохраняет ссылки на необходимые HTML-элементы.
- Добавляет обработчик события клика на кнопку "Закрыть", эмитируя событие final:close.

Данный класс отвечает за отображение финального экрана после оформления заказа, включая отображение общей суммы заказа и возможность закрытия этого экрана.
